openapi: 3.0.0
info:
  title: BF1942 Stats Tournament API
  description: Tournament management and public tournament viewing API
  version: '1.0.0'
  contact:
    name: API Support

servers:
  - url: http://localhost:5000
    description: Development server
  - url: https://api.bf1942stats.com
    description: Production server

paths:
  # ==================== ADMIN TOURNAMENT ENDPOINTS (AUTHENTICATED) ====================

  /stats/admin/tournaments:
    get:
      tags:
        - Admin Tournaments
      summary: List user's tournaments
      description: Get all tournaments created by the authenticated user with match and team counts
      operationId: getTournaments
      security:
        - BearerAuth: []
      responses:
        '200':
          description: List of tournaments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TournamentListResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Admin Tournaments
      summary: Create a new tournament
      operationId: createTournament
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTournamentRequest'
      responses:
        '201':
          description: Tournament created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentDetailResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/admin/tournaments/{id}:
    get:
      tags:
        - Admin Tournaments
      summary: Get tournament details
      description: Get full tournament details including teams, matches grouped by week, files, and latest matches
      operationId: getTournamentById
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Tournament details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentDetailResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Admin Tournaments
      summary: Update tournament details
      description: 'NEW: Updated to support status, game mode, and week dates'
      operationId: updateTournament
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTournamentRequest'
      responses:
        '200':
          description: Tournament updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentDetailResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Admin Tournaments
      summary: Delete a tournament
      operationId: deleteTournament
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Tournament deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/admin/tournaments/{id}/image:
    get:
      tags:
        - Admin Tournaments
      summary: Get tournament hero image
      operationId: getTournamentImage
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Hero image binary data
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/admin/tournaments/{id}/logo:
    get:
      tags:
        - Admin Tournaments
      summary: Get tournament community logo
      operationId: getTournamentLogo
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Community logo binary data
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== ADMIN TOURNAMENT FILES (NEW) ====================

  /stats/admin/tournaments/{id}/files:
    post:
      tags:
        - Admin Tournament Files
      summary: 'NEW: Add a file link to tournament'
      description: Upload tournament file metadata (documents, brackets, rules, etc.)
      operationId: createTournamentFile
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTournamentFileRequest'
      responses:
        '201':
          description: File created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentFileResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/admin/tournaments/{id}/files/{fileId}:
    put:
      tags:
        - Admin Tournament Files
      summary: 'NEW: Update a tournament file link'
      operationId: updateTournamentFile
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: fileId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTournamentFileRequest'
      responses:
        '200':
          description: File updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentFileResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Admin Tournament Files
      summary: 'NEW: Delete a tournament file link'
      operationId: deleteTournamentFile
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: fileId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: File deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== ADMIN TEAM ENDPOINTS ====================

  /stats/admin/tournaments/{tournamentId}/teams:
    post:
      tags:
        - Admin Teams
      summary: Create a new team
      operationId: createTeam
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTournamentTeamRequest'
      responses:
        '201':
          description: Team created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentTeamResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/admin/tournaments/{tournamentId}/teams/{teamId}:
    get:
      tags:
        - Admin Teams
      summary: Get team details
      operationId: getTeam
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
        - name: teamId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Team details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentTeamResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Admin Teams
      summary: Update team details
      operationId: updateTeam
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
        - name: teamId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTournamentTeamRequest'
      responses:
        '200':
          description: Team updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentTeamResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Admin Teams
      summary: Delete a team
      operationId: deleteTeam
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
        - name: teamId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Team deleted successfully
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/admin/tournaments/{tournamentId}/teams/{teamId}/players:
    post:
      tags:
        - Admin Teams
      summary: Add player to team
      operationId: addPlayerToTeam
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
        - name: teamId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddPlayerToTeamRequest'
      responses:
        '200':
          description: Player added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentTeamResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/admin/tournaments/{tournamentId}/teams/{teamId}/players/{playerName}:
    delete:
      tags:
        - Admin Teams
      summary: Remove player from team
      operationId: removePlayerFromTeam
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
        - name: teamId
          in: path
          required: true
          schema:
            type: integer
        - name: playerName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Player removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentTeamResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== ADMIN MATCH ENDPOINTS ====================

  /stats/admin/tournaments/{tournamentId}/matches:
    post:
      tags:
        - Admin Matches
      summary: Create a new match
      operationId: createMatch
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTournamentMatchRequest'
      responses:
        '201':
          description: Match created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentMatchResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/admin/tournaments/{tournamentId}/matches/{matchId}:
    get:
      tags:
        - Admin Matches
      summary: Get match details
      operationId: getMatch
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
        - name: matchId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Match details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentMatchResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Admin Matches
      summary: Update match details
      operationId: updateMatch
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
        - name: matchId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTournamentMatchRequest'
      responses:
        '200':
          description: Match updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentMatchResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Admin Matches
      summary: Delete a match
      operationId: deleteMatch
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
        - name: matchId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Match deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/admin/tournaments/{tournamentId}/matches/{matchId}/maps/{mapId}:
    put:
      tags:
        - Admin Matches
      summary: Update match map metadata
      operationId: updateMatchMap
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
        - name: matchId
          in: path
          required: true
          schema:
            type: integer
        - name: mapId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTournamentMatchMapRequest'
      responses:
        '200':
          description: Map updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentMatchMapResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/admin/tournaments/{tournamentId}/matches/{matchId}/maps/{mapId}/result:
    post:
      tags:
        - Admin Match Results
      summary: Create a manual match result
      operationId: createManualMatchResult
      security:
        - BearerAuth: []
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: integer
        - name: matchId
          in: path
          required: true
          schema:
            type: integer
        - name: mapId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateManualMatchResultRequest'
      responses:
        '201':
          description: Match result created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentMatchResultAdminResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== PUBLIC TOURNAMENT ENDPOINTS ====================

  /stats/tournaments/{idOrName}:
    get:
      tags:
        - Public Tournaments
      summary: Get tournament details (public)
      description: Get tournament details by ID or name. Filters out draft tournaments.
      operationId: getPublicTournament
      parameters:
        - name: idOrName
          in: path
          required: true
          schema:
            type: string
          description: Tournament ID (integer) or name (string)
      responses:
        '200':
          description: Tournament details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicTournamentDetailResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/tournaments/{id}/image:
    get:
      tags:
        - Public Tournaments
      summary: Get tournament hero image (public)
      operationId: getPublicTournamentImage
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Hero image binary data
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/tournaments/{id}/logo:
    get:
      tags:
        - Public Tournaments
      summary: Get tournament community logo (public)
      operationId: getPublicTournamentLogo
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Community logo binary data
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /stats/tournaments/{idOrName}/leaderboard:
    get:
      tags:
        - Public Tournaments
      summary: 'NEW: Get tournament leaderboard (public)'
      description: Get team rankings for a tournament. Returns cumulative standings if week is not specified.
      operationId: getLeaderboard
      parameters:
        - name: idOrName
          in: path
          required: true
          schema:
            type: string
          description: Tournament ID (integer) or name (string)
        - name: week
          in: query
          required: false
          schema:
            type: string
          description: Week identifier (optional, returns cumulative if not specified)
      responses:
        '200':
          description: Tournament leaderboard
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicTournamentLeaderboardResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

# ==================== COMPONENTS ====================

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    BadRequestError:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    UnauthorizedError:
      description: Unauthorized - authentication required or failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          example: Error message

    # ==================== TOURNAMENT SCHEMAS ====================

    TournamentListResponse:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        organizer:
          type: string
        game:
          type: string
          enum: [bf1942, fh2, bfvietnam]
        createdAt:
          type: string
          format: date-time
        anticipatedRoundCount:
          type: integer
          nullable: true
        matchCount:
          type: integer
        teamCount:
          type: integer
        hasHeroImage:
          type: boolean
        hasCommunityLogo:
          type: boolean
        hasRules:
          type: boolean
        serverGuid:
          type: string
          nullable: true
        serverName:
          type: string
          nullable: true
        discordUrl:
          type: string
          nullable: true
        forumUrl:
          type: string
          nullable: true
        theme:
          $ref: '#/components/schemas/TournamentThemeResponse'
          nullable: true

    TournamentDetailResponse:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        organizer:
          type: string
        game:
          type: string
          enum: [bf1942, fh2, bfvietnam]
        createdAt:
          type: string
          format: date-time
        anticipatedRoundCount:
          type: integer
          nullable: true
        status:
          type: string
          description: 'NEW: Tournament status'
          enum: [draft, registration, open, closed]
        gameMode:
          type: string
          description: 'NEW: Game mode (Conquest, CTF, TDM, Coop, or custom)'
          nullable: true
        teams:
          type: array
          items:
            $ref: '#/components/schemas/TournamentTeamResponse'
        matchesByWeek:
          type: array
          items:
            $ref: '#/components/schemas/MatchWeekGroup'
        latestMatches:
          type: array
          description: 'NEW: 2 most recent completed matches'
          items:
            $ref: '#/components/schemas/TournamentMatchResponse'
        weekDates:
          type: array
          description: 'NEW: Tournament week dates'
          items:
            $ref: '#/components/schemas/TournamentWeekDateResponse'
        files:
          type: array
          description: 'NEW: Tournament files (documents, brackets, etc.)'
          items:
            $ref: '#/components/schemas/TournamentFileResponse'
        hasHeroImage:
          type: boolean
        hasCommunityLogo:
          type: boolean
        rules:
          type: string
          nullable: true
          description: Markdown-formatted rules
        serverGuid:
          type: string
          nullable: true
        serverName:
          type: string
          nullable: true
        discordUrl:
          type: string
          nullable: true
        forumUrl:
          type: string
          nullable: true
        theme:
          $ref: '#/components/schemas/TournamentThemeResponse'
          nullable: true

    PublicTournamentDetailResponse:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        organizer:
          type: string
        game:
          type: string
          enum: [bf1942, fh2, bfvietnam]
        createdAt:
          type: string
          format: date-time
        anticipatedRoundCount:
          type: integer
          nullable: true
        status:
          type: string
          enum: [registration, open, closed]
          description: Draft status filtered out in public API
        gameMode:
          type: string
          nullable: true
        teams:
          type: array
          items:
            $ref: '#/components/schemas/PublicTournamentTeamResponse'
        matchesByWeek:
          type: array
          items:
            $ref: '#/components/schemas/PublicMatchWeekGroup'
        latestMatches:
          type: array
          description: 2 most recent completed matches
          items:
            $ref: '#/components/schemas/PublicTournamentMatchResponse'
        hasHeroImage:
          type: boolean
        hasCommunityLogo:
          type: boolean
        rules:
          type: string
          nullable: true
        serverGuid:
          type: string
          nullable: true
        serverName:
          type: string
          nullable: true
        discordUrl:
          type: string
          nullable: true
        forumUrl:
          type: string
          nullable: true
        theme:
          $ref: '#/components/schemas/PublicTournamentThemeResponse'
          nullable: true

    CreateTournamentRequest:
      type: object
      required:
        - name
        - organizer
        - game
      properties:
        name:
          type: string
          minLength: 1
        organizer:
          type: string
          minLength: 1
          description: Must match an existing player name
        game:
          type: string
          enum: [bf1942, fh2, bfvietnam]
        anticipatedRoundCount:
          type: integer
          nullable: true
        serverGuid:
          type: string
          nullable: true
        heroImageBase64:
          type: string
          nullable: true
          description: Base64-encoded hero image (max 4MB)
        heroImageContentType:
          type: string
          nullable: true
          example: image/jpeg
        communityLogoBase64:
          type: string
          nullable: true
          description: Base64-encoded community logo (max 4MB)
        communityLogoContentType:
          type: string
          nullable: true
          example: image/jpeg
        rules:
          type: string
          nullable: true
          description: Markdown-formatted rules
        discordUrl:
          type: string
          nullable: true
        forumUrl:
          type: string
          nullable: true
        theme:
          $ref: '#/components/schemas/TournamentThemeRequest'
          nullable: true

    UpdateTournamentRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true
        organizer:
          type: string
          nullable: true
        game:
          type: string
          enum: [bf1942, fh2, bfvietnam]
          nullable: true
        anticipatedRoundCount:
          type: integer
          nullable: true
        serverGuid:
          type: string
          nullable: true
        status:
          type: string
          description: 'NEW: Tournament status'
          enum: [draft, registration, open, closed]
          nullable: true
        gameMode:
          type: string
          description: 'NEW: Game mode (custom values allowed)'
          nullable: true
        heroImageBase64:
          type: string
          nullable: true
        heroImageContentType:
          type: string
          nullable: true
        communityLogoBase64:
          type: string
          nullable: true
        communityLogoContentType:
          type: string
          nullable: true
        removeHeroImage:
          type: boolean
          default: false
        removeCommunityLogo:
          type: boolean
          default: false
        rules:
          type: string
          nullable: true
        discordUrl:
          type: string
          nullable: true
        forumUrl:
          type: string
          nullable: true
        theme:
          $ref: '#/components/schemas/TournamentThemeRequest'
          nullable: true
        weekDates:
          type: array
          description: 'NEW: Replace all week dates'
          items:
            $ref: '#/components/schemas/TournamentWeekDateRequest'
          nullable: true

    TournamentThemeRequest:
      type: object
      properties:
        backgroundColour:
          type: string
          nullable: true
          pattern: '^#[0-9A-Fa-f]{3,4}([0-9A-Fa-f]{3})?$'
          example: '#RRGGBB'
        textColour:
          type: string
          nullable: true
          pattern: '^#[0-9A-Fa-f]{3,4}([0-9A-Fa-f]{3})?$'
        accentColour:
          type: string
          nullable: true
          pattern: '^#[0-9A-Fa-f]{3,4}([0-9A-Fa-f]{3})?$'

    TournamentThemeResponse:
      type: object
      properties:
        id:
          type: integer
        backgroundColour:
          type: string
          nullable: true
        textColour:
          type: string
          nullable: true
        accentColour:
          type: string
          nullable: true

    PublicTournamentThemeResponse:
      type: object
      properties:
        backgroundColour:
          type: string
          nullable: true
        textColour:
          type: string
          nullable: true
        accentColour:
          type: string
          nullable: true

    # ==================== TOURNAMENT FILES (NEW) ====================

    TournamentFileResponse:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        url:
          type: string
        category:
          type: string
          nullable: true
          example: bracket
        uploadedAt:
          type: string
          format: date-time

    CreateTournamentFileRequest:
      type: object
      required:
        - name
        - url
      properties:
        name:
          type: string
          minLength: 1
          example: Tournament Bracket
        url:
          type: string
          minLength: 1
          example: https://example.com/bracket.pdf
        category:
          type: string
          nullable: true
          example: bracket

    UpdateTournamentFileRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true
        url:
          type: string
          nullable: true
        category:
          type: string
          nullable: true

    # ==================== WEEK DATES (NEW) ====================

    TournamentWeekDateResponse:
      type: object
      properties:
        id:
          type: integer
        week:
          type: string
          example: 'Week 1'
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time

    TournamentWeekDateRequest:
      type: object
      required:
        - week
        - startDate
        - endDate
      properties:
        week:
          type: string
          example: 'Week 1'
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time

    # ==================== TEAM SCHEMAS ====================

    TournamentTeamResponse:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        players:
          type: array
          items:
            $ref: '#/components/schemas/TournamentTeamPlayerResponse'

    PublicTournamentTeamResponse:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        players:
          type: array
          items:
            $ref: '#/components/schemas/PublicTournamentTeamPlayerResponse'

    TournamentTeamPlayerResponse:
      type: object
      properties:
        playerName:
          type: string

    PublicTournamentTeamPlayerResponse:
      type: object
      properties:
        playerName:
          type: string

    CreateTournamentTeamRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1

    UpdateTournamentTeamRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true

    AddPlayerToTeamRequest:
      type: object
      required:
        - playerName
      properties:
        playerName:
          type: string
          minLength: 1
          description: Must match an existing player name

    # ==================== MATCH SCHEMAS ====================

    TournamentMatchResponse:
      type: object
      properties:
        id:
          type: integer
        scheduledDate:
          type: string
          format: date-time
        team1Id:
          type: integer
        team1Name:
          type: string
        team2Id:
          type: integer
        team2Name:
          type: string
        serverGuid:
          type: string
          nullable: true
        serverName:
          type: string
          nullable: true
        week:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        maps:
          type: array
          items:
            $ref: '#/components/schemas/TournamentMatchMapResponse'

    PublicTournamentMatchResponse:
      type: object
      properties:
        id:
          type: integer
        scheduledDate:
          type: string
          format: date-time
        team1Name:
          type: string
        team2Name:
          type: string
        serverGuid:
          type: string
          nullable: true
        serverName:
          type: string
          nullable: true
        week:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        maps:
          type: array
          items:
            $ref: '#/components/schemas/PublicTournamentMatchMapResponse'

    MatchWeekGroup:
      type: object
      properties:
        week:
          type: string
          nullable: true
        matches:
          type: array
          items:
            $ref: '#/components/schemas/TournamentMatchResponse'

    PublicMatchWeekGroup:
      type: object
      properties:
        week:
          type: string
          nullable: true
        matches:
          type: array
          items:
            $ref: '#/components/schemas/PublicTournamentMatchResponse'

    CreateTournamentMatchRequest:
      type: object
      required:
        - team1Id
        - team2Id
        - mapNames
      properties:
        scheduledDate:
          type: string
          format: date-time
          nullable: true
        team1Id:
          type: integer
          minimum: 1
        team2Id:
          type: integer
          minimum: 1
        mapNames:
          type: array
          minItems: 1
          items:
            type: string
            minLength: 1
        serverGuid:
          type: string
          nullable: true
        serverName:
          type: string
          nullable: true
        week:
          type: string
          nullable: true

    UpdateTournamentMatchRequest:
      type: object
      properties:
        scheduledDate:
          type: string
          format: date-time
          nullable: true
        team1Id:
          type: integer
          nullable: true
        team2Id:
          type: integer
          nullable: true
        mapNames:
          type: array
          items:
            type: string
          nullable: true
        serverGuid:
          type: string
          nullable: true
        serverName:
          type: string
          nullable: true
        week:
          type: string
          nullable: true

    TournamentMatchMapResponse:
      type: object
      properties:
        id:
          type: integer
        mapName:
          type: string
        mapOrder:
          type: integer
        teamId:
          type: integer
          nullable: true
        teamName:
          type: string
          nullable: true
        matchResults:
          type: array
          items:
            $ref: '#/components/schemas/TournamentMatchResultResponse'

    PublicTournamentMatchMapResponse:
      type: object
      properties:
        id:
          type: integer
        mapName:
          type: string
        mapOrder:
          type: integer
        teamId:
          type: integer
          nullable: true
        teamName:
          type: string
          nullable: true
        matchResults:
          type: array
          items:
            $ref: '#/components/schemas/PublicTournamentMatchResultResponse'

    UpdateTournamentMatchMapRequest:
      type: object
      properties:
        mapName:
          type: string
          nullable: true

    # ==================== MATCH RESULT SCHEMAS ====================

    TournamentMatchResultResponse:
      type: object
      properties:
        id:
          type: integer
        team1Id:
          type: integer
          nullable: true
        team1Name:
          type: string
          nullable: true
        team2Id:
          type: integer
          nullable: true
        team2Name:
          type: string
          nullable: true
        winningTeamId:
          type: integer
          nullable: true
        winningTeamName:
          type: string
          nullable: true
        team1Tickets:
          type: integer
        team2Tickets:
          type: integer

    PublicTournamentMatchResultResponse:
      type: object
      properties:
        id:
          type: integer
        team1Id:
          type: integer
          nullable: true
        team1Name:
          type: string
          nullable: true
        team2Id:
          type: integer
          nullable: true
        team2Name:
          type: string
          nullable: true
        winningTeamId:
          type: integer
          nullable: true
        winningTeamName:
          type: string
          nullable: true
        team1Tickets:
          type: integer
        team2Tickets:
          type: integer

    TournamentMatchResultAdminResponse:
      type: object
      properties:
        id:
          type: integer
        team1Id:
          type: integer
          nullable: true
        team1Name:
          type: string
          nullable: true
        team2Id:
          type: integer
          nullable: true
        team2Name:
          type: string
          nullable: true
        winningTeamId:
          type: integer
          nullable: true
        winningTeamName:
          type: string
          nullable: true
        team1Tickets:
          type: integer
        team2Tickets:
          type: integer
        roundId:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time

    CreateManualMatchResultRequest:
      type: object
      required:
        - team1Id
        - team2Id
      properties:
        team1Id:
          type: integer
        team2Id:
          type: integer
        winningTeamId:
          type: integer
          nullable: true
        team1Tickets:
          type: integer
          default: 0
        team2Tickets:
          type: integer
          default: 0
        roundId:
          type: string
          nullable: true
          description: Optional round ID to link this result to a round

    # ==================== LEADERBOARD SCHEMAS (NEW) ====================

    PublicTournamentLeaderboardResponse:
      type: object
      properties:
        tournamentId:
          type: integer
        tournamentName:
          type: string
        week:
          type: string
          nullable: true
          description: 'null for cumulative standings'
        rankings:
          type: array
          items:
            $ref: '#/components/schemas/PublicTeamRankingResponse'

    PublicTeamRankingResponse:
      type: object
      properties:
        rank:
          type: integer
        teamId:
          type: integer
        teamName:
          type: string
        matchesPlayed:
          type: integer
        victories:
          type: integer
        ties:
          type: integer
        losses:
          type: integer
        roundsWon:
          type: integer
        roundsTied:
          type: integer
        roundsLost:
          type: integer
        ticketsFor:
          type: integer
        ticketsAgainst:
          type: integer
        ticketDifferential:
          type: integer
        points:
          type: integer
          description: Primary ranking metric
        totalRounds:
          type: integer
          description: Calculated field (roundsWon + roundsTied + roundsLost)
